# StarCraft II 强化学习环境配置说明

## 环境信息

- **操作系统**: Windows 10
- **Python版本**: 3.10.19
- **Conda环境**: sc2_rl
- **PySC2版本**: 4.0.0
- **SC2安装路径**: C:\Program Files (x86)\StarCraft II
- **SC2版本**: Base95841

## 已安装的关键依赖

```
pysc2==4.0.0
numpy==2.2.6
protobuf==3.20.3  # 重要：必须使用3.20.3以兼容PySC2
absl-py==2.3.1
pygame==2.6.1
```

## 已下载的Mini-game地图

位置: `C:\Program Files (x86)\StarCraft II\Maps\mini_games\`

1. BuildMarines.SC2Map
2. CollectMineralsAndGas.SC2Map
3. CollectMineralShards.SC2Map
4. DefeatRoaches.SC2Map
5. DefeatZerglingsAndBanelings.SC2Map
6. FindAndDefeatZerglings.SC2Map
7. MoveToBeacon.SC2Map

## 关键配置步骤

### 1. Conda环境创建
```bash
conda create -n sc2_rl python=3.10 -y
conda activate sc2_rl
```

### 2. 安装依赖
```bash
pip install pysc2
pip install protobuf==3.20.3  # 降级protobuf解决兼容性问题
```

### 3. 配置SC2路径
```bash
python setup_sc2_env.py
```
或在PowerShell中手动设置:
```powershell
$env:SC2PATH='C:\Program Files (x86)\StarCraft II'
```

### 4. 下载地图
```bash
python download_maps.py
```

### 5. 验证环境
```bash
python test_sc2_env.py --norender
```

## 常见问题解决

### 问题1: Protobuf版本不兼容
**错误信息**: `TypeError: Descriptors cannot be created directly`

**解决方案**:
```bash
pip install protobuf==3.20.3
```

### 问题2: 地图未找到
**错误信息**: `ValueError: Map mini_games\MoveToBeacon.SC2Map not found`

**解决方案**:
```bash
python download_maps.py
```

### 问题3: SC2PATH未设置
**解决方案**:
```bash
python setup_sc2_env.py
```

### 问题4: PowerShell不支持&&操作符
**解决方案**: 分开执行命令，或使用分号`;`

## 测试结果

### 环境测试 (test_sc2_env.py)
- ✓ SC2PATH配置正确
- ✓ 环境创建成功
- ✓ 环境重置成功
- ✓ 执行5个测试步骤成功

### Agent测试 (simple_agent.py)
- ✓ 随机agent可以正常运行
- ✓ 可以与环境交互
- ✓ 观察和动作空间正常

## 项目结构

```
SC2_RL/
├── README.md                      # 项目总文档
├── story initialization.md        # 初始化记录
├── 环境配置说明.md                 # 本文件
├── requirements.txt               # Python依赖
├── setup_sc2_env.py              # SC2路径配置
├── download_maps.py              # 地图下载工具
├── test_sc2_env.py               # 环境测试脚本
└── simple_agent.py               # 简单agent示例
```

## 下一步开发建议

### 1. 实现强化学习算法
- DQN (Deep Q-Network)
- A3C (Asynchronous Advantage Actor-Critic)
- PPO (Proximal Policy Optimization)

### 2. 改进Agent设计
- 实现特征提取网络
- 设计奖励函数
- 添加经验回放机制

### 3. 训练基础设施
- 添加TensorBoard监控
- 实现模型检查点保存
- 记录训练指标

### 4. 多任务学习
- 在多个mini-games上训练
- 迁移学习实验
- 多智能体协作

## 参考资源

- [PySC2 GitHub](https://github.com/google-deepmind/pysc2)
- [SC2 API文档](https://github.com/Blizzard/s2client-proto)
- [DeepMind SC2LE论文](https://deepmind.com/blog/article/deepmind-and-blizzard-open-starcraft-ii-ai-research-environment)

## 环境激活命令

每次使用前需要激活环境:
```bash
conda activate sc2_rl
cd D:\Cursor_project\SC2_RL
```

如需要可视化，运行:
```bash
python simple_agent.py --episodes=3 --render
```

无可视化运行（更快）:
```bash
python simple_agent.py --episodes=10 --norender --max_steps=100
```

